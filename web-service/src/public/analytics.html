<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Analytics - Admin</title>
  <link rel="stylesheet" href="./assets/style.css">
  <script src="https://kit.fontawesome.com/e7df210b8c.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .admin-badge {
      background-color: #ff5722;
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      margin-left: 8px;
    }
    .analytics-container {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-top: 20px;
    }
    .analytics-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .filter-options {
      display: flex;
      gap: 10px;
    }
    .filter-options select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .filter-options button {
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
    }
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    .chart-card {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .chart-title {
      font-size: 1.1em;
      font-weight: 500;
      margin-bottom: 15px;
      color: #333;
    }
    .chart-container {
      position: relative;
      height: 250px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 30px;
    }
    .stat-card {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      text-align: center;
    }
    .stat-title {
      font-size: 0.9em;
      color: #666;
      margin-bottom: 5px;
    }
    .stat-value {
      font-size: 1.8em;
      font-weight: 600;
      color: #1976d2;
    }
    .stat-change {
      font-size: 0.85em;
      margin-top: 5px;
    }
    .positive-change {
      color: #388e3c;
    }
    .negative-change {
      color: #d32f2f;
    }
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .data-table th, .data-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    .data-table th {
      background-color: #f5f5f5;
      font-weight: bold;
    }
    .data-table tr:hover {
      background-color: #f9f9f9;
    }
    .export-btn {
      background-color: #388e3c;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    @media (max-width: 768px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body class="dashboard-bg">
  <!-- Consistent Navbar for all pages -->
  <header class="navbar">
    <div class="logo">
      <a href="index.html"><img src="./assets/img/logo.png" alt="Logo" height="70px"></a>
    </div>
    <nav class="links">
      <li><a href="admin-dashboard.html" class="nb">Dashboard</a></li>
      <li><a href="manage-complaints.html" class="nb">Manage Complaints</a></li>
      <li><a href="manage-users.html" class="nb">Manage Users</a></li>
      <li><a href="analytics.html" class="nb active">Analytics</a></li>
      <li>
        <div class="profile-dropdown">
          <button class="profile-btn" id="profileBtn">
            <i class="fa-solid fa-user-shield"></i>
            <span id="profileName"></span>
            <span class="admin-badge">Admin</span>
            <i class="fa-solid fa-caret-down"></i>
          </button>
          <div class="profile-menu" id="profileMenu">
            <div class="profile-info">
              <i class="fa-solid fa-user-shield"></i>
              <div>
                <div><strong id="profileUsername">Username</strong> <span class="admin-badge">Admin</span></div>
                <div id="profileEmail" style="font-size:0.95em;color:#666;"></div>
              </div>
            </div>
            <div class="profile-details">
              <p><i class="fa-solid fa-id-card"></i> Student ID: <span id="profileEmailDetail"></span></p>
              <p><i class="fa-solid fa-calendar"></i> Joined: <span id="profileJoined"></span></p>
            </div>
            <button class="logout-btn" id="logoutBtn"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
          </div>
        </div>
      </li>
    </nav>
  </header>
  
  <div class="dashboard-container">
    <h1><i class="fa-solid fa-chart-line"></i> Analytics Dashboard</h1>
    <p>View and analyze complaint data and system performance metrics.</p>
    
    <div class="analytics-container">
      <div class="analytics-header">
        <div class="filter-options">
          <select id="timeRangeFilter">
            <option value="7days">Last 7 Days</option>
            <option value="30days" selected>Last 30 Days</option>
            <option value="90days">Last 90 Days</option>
            <option value="1year">Last Year</option>
            <option value="all">All Time</option>
          </select>
          <select id="departmentFilter">
            <option value="all">All Departments</option>
            <option value="academic">Academic</option>
            <option value="administrative">Administrative</option>
            <option value="facilities">Facilities</option>
            <option value="it">IT Services</option>
            <option value="library">Library</option>
            <option value="other">Other</option>
          </select>
          <button id="applyFilters"><i class="fa-solid fa-filter"></i> Apply Filters</button>
        </div>
        <button class="export-btn" id="exportData"><i class="fa-solid fa-file-export"></i> Export Data</button>
      </div>
      
      <!-- Key Statistics -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-title">Total Complaints</div>
          <div class="stat-value">247</div>
          <div class="stat-change positive-change"><i class="fa-solid fa-arrow-up"></i> 12% from last period</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Resolution Rate</div>
          <div class="stat-value">78%</div>
          <div class="stat-change positive-change"><i class="fa-solid fa-arrow-up"></i> 5% from last period</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Avg. Resolution Time</div>
          <div class="stat-value">3.2 days</div>
          <div class="stat-change positive-change"><i class="fa-solid fa-arrow-down"></i> 0.5 days from last period</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">User Satisfaction</div>
          <div class="stat-value">4.2/5</div>
          <div class="stat-change positive-change"><i class="fa-solid fa-arrow-up"></i> 0.3 from last period</div>
        </div>
      </div>
      
      <!-- Charts -->
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-title">Complaints by Department</div>
          <div class="chart-container">
            <canvas id="departmentChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">Complaints by Status</div>
          <div class="chart-container">
            <canvas id="statusChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">Complaints Trend</div>
          <div class="chart-container">
            <canvas id="trendChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">Resolution Time by Department</div>
          <div class="chart-container">
            <canvas id="resolutionTimeChart"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Top Issues Table -->
      <h3>Top Reported Issues</h3>
      <table class="data-table">
        <thead>
          <tr>
            <th>Issue</th>
            <th>Department</th>
            <th>Count</th>
            <th>Avg. Resolution Time</th>
            <th>Trend</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Wi-Fi Connectivity</td>
            <td>IT Services</td>
            <td>42</td>
            <td>1.5 days</td>
            <td><span class="positive-change"><i class="fa-solid fa-arrow-down"></i> Decreasing</span></td>
          </tr>
          <tr>
            <td>Classroom Equipment</td>
            <td>Facilities</td>
            <td>38</td>
            <td>2.3 days</td>
            <td><span class="negative-change"><i class="fa-solid fa-arrow-up"></i> Increasing</span></td>
          </tr>
          <tr>
            <td>Course Registration</td>
            <td>Academic</td>
            <td>35</td>
            <td>4.1 days</td>
            <td><span class="positive-change"><i class="fa-solid fa-arrow-down"></i> Decreasing</span></td>
          </tr>
          <tr>
            <td>Library Resources</td>
            <td>Library</td>
            <td>29</td>
            <td>2.8 days</td>
            <td><span class="negative-change"><i class="fa-solid fa-equals"></i> Stable</span></td>
          </tr>
          <tr>
            <td>Bathroom Facilities</td>
            <td>Facilities</td>
            <td>27</td>
            <td>3.5 days</td>
            <td><span class="negative-change"><i class="fa-solid fa-arrow-up"></i> Increasing</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <script>
  // Check if user is logged in and is an admin
  const userName = localStorage.getItem('userName');
  const userStudentId = localStorage.getItem('userStudentId');
  const userRole = localStorage.getItem('userRole');
  
  // Redirect to login page if not logged in or not an admin
  if (!userName || !userStudentId) {
    window.location.href = "login.html";
  } else if (userRole !== 'admin') {
    window.location.href = "dashboard.html";
  }
  
  // Set user info from localStorage
  const userJoined = localStorage.getItem('userJoined') || '2023-01-01';

  document.getElementById('profileName').innerText = userName;
  document.getElementById('profileUsername').innerText = userName;
  document.getElementById('profileEmail').innerText = userStudentId;
  document.getElementById('profileEmailDetail').innerText = userStudentId;
  document.getElementById('profileJoined').innerText = userJoined;

  // Dropdown toggle
  document.getElementById('profileBtn').onclick = function(e) {
    e.stopPropagation();
    document.getElementById('profileMenu').classList.toggle('show');
  };
  
  // Hide dropdown when clicking outside
  window.onclick = function(event) {
    if (!event.target.closest('.profile-dropdown')) {
      document.getElementById('profileMenu').classList.remove('show');
    }
  }
  
  // Logout functionality
  document.getElementById('logoutBtn').onclick = function() {
    localStorage.removeItem('userName');
    localStorage.removeItem('userStudentId');
    localStorage.removeItem('userRole');
    localStorage.removeItem('userJoined');
    window.location.href = "index.html";
  };
  
  // Initialize charts
  function initCharts() {
    // Department Chart (Pie)
    const departmentCtx = document.getElementById('departmentChart').getContext('2d');
    const departmentChart = new Chart(departmentCtx, {
      type: 'pie',
      data: {
        labels: ['Academic', 'Administrative', 'Facilities', 'IT Services', 'Library', 'Other'],
        datasets: [{
          data: [65, 40, 75, 42, 25, 15],
          backgroundColor: [
            '#4CAF50', '#2196F3', '#FFC107', '#9C27B0', '#FF5722', '#607D8B'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'right',
          }
        }
      }
    });
    
    // Status Chart (Doughnut)
    const statusCtx = document.getElementById('statusChart').getContext('2d');
    const statusChart = new Chart(statusCtx, {
      type: 'doughnut',
      data: {
        labels: ['Open', 'In Progress', 'Resolved', 'Closed'],
        datasets: [{
          data: [45, 65, 95, 42],
          backgroundColor: [
            '#F44336', '#FFC107', '#4CAF50', '#607D8B'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'right',
          }
        }
      }
    });
    
    // Trend Chart (Line)
    const trendCtx = document.getElementById('trendChart').getContext('2d');
    const trendChart = new Chart(trendCtx, {
      type: 'line',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        datasets: [{
          label: 'Complaints',
          data: [12, 19, 15, 17, 22, 25, 32, 30, 28, 26, 20, 18],
          borderColor: '#1976d2',
          backgroundColor: 'rgba(25, 118, 210, 0.1)',
          tension: 0.3,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
    
    // Resolution Time Chart (Bar)
    const resolutionTimeCtx = document.getElementById('resolutionTimeChart').getContext('2d');
    const resolutionTimeChart = new Chart(resolutionTimeCtx, {
      type: 'bar',
      data: {
        labels: ['Academic', 'Administrative', 'Facilities', 'IT Services', 'Library', 'Other'],
        datasets: [{
          label: 'Average Days to Resolve',
          data: [4.2, 5.1, 3.5, 1.8, 2.9, 3.7],
          backgroundColor: [
            '#4CAF50', '#2196F3', '#FFC107', '#9C27B0', '#FF5722', '#607D8B'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Days'
            }
          }
        }
      }
    });
  }
  
  // Initialize charts when page loads
  document.addEventListener('DOMContentLoaded', initCharts);
  
  // Apply filters button
  document.getElementById('applyFilters').addEventListener('click', function() {
    const timeRange = document.getElementById('timeRangeFilter').value;
    const department = document.getElementById('departmentFilter').value;
    
    // In a real application, this would fetch new data based on filters
    alert(`Filters applied: Time Range = ${timeRange}, Department = ${department}`);
    
    // For demo purposes, we'll just reinitialize the charts
    initCharts();
  });
  
  // Export data button
  document.getElementById('exportData').addEventListener('click', function() {
    const timeRange = document.getElementById('timeRangeFilter').value;
    const department = document.getElementById('departmentFilter').value;
    
    // In a real application, this would generate and download a report
    alert(`Exporting data for: Time Range = ${timeRange}, Department = ${department}`);
  });
</script>
</body>
</html>